function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,a,n,i,l=[],d=!0,c=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;d=!1}else for(;!(d=(o=n.call(r)).done)&&(l.push(o.value),l.length!==t);d=!0);}catch(e){c=!0,a=e}finally{try{if(!d&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}import{getCards,getUser,addNewCard,editProfile,editAvatar,deleteCard}from"./api.js";import{createCard}from"./card.js";import{openPopup,closePopup}from"./popup.js";import{enableValidation}from"./validate.js";var userData,_newCardForm$elements,link,place_name,submit,_profileEditForm$elem3,name,description,_submit,_editAvatarForm$eleme,_link,_submit2,_submit3,cardList=document.querySelector(".places__list"),profileTitle=document.querySelector(".profile__title"),profileDescription=document.querySelector(".profile__description"),profileAvatar=document.querySelector(".profile__image"),newCardButton=document.querySelector(".profile__add-button"),newCardModal=document.querySelector(".popup_type_new-card"),newCardForm=document["new-place"],profileEditButton=document.querySelector(".profile__edit-button"),profileEditModal=document.querySelector(".popup_type_edit"),profileEditForm=document["edit-profile"],editAvatarModal=document.querySelector(".popup_type_avatar"),editAvatarForm=document["edit-avatar"],showCardModal=document.querySelector(".popup_type_image"),showCardModalImage=document.querySelector(".popup__image"),showCardModalCaption=document.querySelector(".popup__caption"),deleteCardModal=document.querySelector(".popup_type_delete"),deleteCardForm=document["delete-card"],promises=Promise.all([getCards(),getUser()]);promises.then(function(e){var t,e=_slicedToArray(e,2),r=e[0],o=e[1];userData=o,profileTitle.textContent=o.name,profileDescription.textContent=o.about,profileAvatar.style.backgroundImage="url(".concat(o.avatar,")"),profileEditForm&&(t=(e=profileEditForm.elements).name,e=e.description,t.value=o.name,e.value=o.about),r.forEach(function(e){cardList.append(createCard(e,o,deleteCardModal))})}).catch(function(e){console.error("Произошла ошибка: ' ".concat(e))}).finally(function(){cardList=document.querySelector(".places__list")}),newCardButton&&newCardModal&&newCardButton.addEventListener("click",function(e){e.currentTarget&&openPopup(newCardModal)}),newCardForm&&(_newCardForm$elements=newCardForm.elements,link=_newCardForm$elements.link,place_name=_newCardForm$elements.place_name,(submit=_newCardForm$elements.submit).addEventListener("click",function(e){e.preventDefault(),submit.textContent="Сохранение...",addNewCard(place_name.value,link.value).then(function(e){cardList.prepend(createCard(e,userData,deleteCardModal)),link.value="",place_name.value="",closePopup(newCardForm.closest(".popup_is-opened"))}).catch(function(e){console.error("Произошла ошибка: ",e)}).finally(function(){submit.textContent="Сохранить"})})),profileEditButton&&profileEditModal&&profileEditForm&&profileEditButton.addEventListener("click",function(e){var t;e.currentTarget&&(t=(e=profileEditForm.elements).name,e=e.description,t.value=userData.name,e.value=userData.about,openPopup(profileEditModal))}),profileEditForm&&(_profileEditForm$elem3=profileEditForm.elements,name=_profileEditForm$elem3.name,description=_profileEditForm$elem3.description,(_submit=_profileEditForm$elem3.submit).addEventListener("click",function(e){e.preventDefault(),_submit.textContent="Сохранение...",editProfile(name.value,description.value).then(function(e){userData=e,profileTitle.textContent=e.name,profileDescription.textContent=e.about,closePopup(profileEditForm.closest(".popup_is-opened"))}).catch(function(e){console.error("Произошла ошибка: ",e)}).finally(function(){_submit.textContent="Сохранить"})})),profileAvatar&&editAvatarModal&&profileAvatar.addEventListener("click",function(e){e.currentTarget&&openPopup(editAvatarModal)}),editAvatarForm&&(_editAvatarForm$eleme=editAvatarForm.elements,_link=_editAvatarForm$eleme.link,(_submit2=_editAvatarForm$eleme.submit).addEventListener("click",function(e){e.preventDefault(),_submit2.textContent="Сохранение...",editAvatar(_link.value).then(function(e){userData=e,profileAvatar.style.backgroundImage="url(".concat(e.avatar,")"),_link.value="",closePopup(editAvatarForm.closest(".popup_is-opened"))}).catch(function(e){console.error("Произошла ошибка: ",e)}).finally(function(){_submit2.textContent="Сохранить"})})),cardList&&showCardModal&&cardList.addEventListener("click",function(e){e.stopPropagation();var t,e=e.target.closest(".card__image");e&&(t=e.parentElement.querySelector(".card__title"),showCardModalImage.src=e.src,showCardModalCaption.textContent=t.textContent,openPopup(showCardModal))}),deleteCardModal&&deleteCardForm&&(_submit3=deleteCardForm.elements.submit).addEventListener("click",function(e){e.preventDefault(),_submit3.textContent="Удаление...";var t=window.localStorage.getItem("deleted_card");t&&deleteCard(t).then(function(e){document.querySelector('[data-card-uid="'.concat(t,'"]')).remove(),window.localStorage.removeItem("deleted_card"),closePopup(deleteCardModal)}).catch(function(e){console.error("Ошибка при удалении карточки: ",e)}).finally(function(){_submit3.textContent="Да"})}),enableValidation();